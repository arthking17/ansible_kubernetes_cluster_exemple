---
  - name: init kubeadm
    command: kubeadm init --pod-network-cidr=192.168.136.0/24
  - name: create .kube dir
    file:
      path: $HOME/.kube
      state: directory
      mode: 0755
  - name: copy /etc/kubernetes/admin.conf to $HOME/.kube/config
    copy:
      src: /etc/kubernetes/admin.conf
      dest: $HOME/.kube/config
      owner: root
      remote_src: yes

  - name: generate token
    command: kubeadm token create --print-join-command
    register: cmd_join_cluster

  - debug: var=cmd_join_cluster.stdout

  - local_action: copy content={{ cmd_join_cluster }} dest=roles/master/vars/cmd_join_cluster.yml